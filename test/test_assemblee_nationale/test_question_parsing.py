# -*- coding: utf-8 -*-

import unittest

import requests

from assemblee_nationale.parsing.question_parser import parse_question


class QuestionParsingTest(unittest.TestCase):
    def test_question_parsing(self):
        expected_result = {"source": "http://questions.assemblee-nationale.fr/q14/14-67716QE.htm", "legislature": "14", "type": "QE", "numero": "67716", "date_question": "2014-10-28", "date_retrait": "", "date_reponse": "", "date_signalement": "", "date_cht_attr": "", "page_question": "8856", "page_reponse": "", "ministere_attribue": "Affaires sociales, santé et droits des femmes", "ministere_interroge": "Affaires sociales, santé et droits des femmes", "tete_analyse": "soins palliatifs", "analyse": "formation universitaire", "rubrique": "santé", "question": "Mme Michèle Delaunay attire l'attention de Mme la ministre des affaires sociales, de la santé et des droits des femmes sur la création d'une filière universitaire de médecine palliative. Il existe aujourd'hui en France 120 unités de soins palliatifs, 350 équipes mobiles de soins palliatifs et 4 000 lits identifiés de soins palliatifs ; pourtant, aucune filière de médecine palliative ne prépare spécifiquement les médecins et équipes soignantes à ce domaine qui est amené à se développer dans les années à venir. Des diplômes d'études spécialisées (DES) « urgence » et « gériatrie » vont être prochainement créés et pour les professionnels qui exercent dans les soins palliatifs, il est important que voit le jour également un DES « médecine palliative » pour répondre à un véritable besoin. Il est important de prendre en compte le fait que les « baby » boomers entrent aujourd'hui dans le champ de l'âge et qu'on prévoit que le nombre de décès annuel, parfaitement stable depuis 1950, va augmenter de 50 % d'ici 2050, amenant un développement considérable du besoin d'accompagnement de la fin de vie. Elle lui demande donc ce que le Gouvernement entend mettre en place pour permettre le développement de cette filière majeure pour cet accompagnement de la fin de vie.", "reponse": "", "motif_retrait": "", "auteur": "Michèle Delaunay"}

        data = requests.get(expected_result['source']).content
        parsing_result = parse_question(expected_result['source'], data)

        self.assertDictEqual(expected_result, parsing_result)

    def test_question_parsing_with_table(self):
        expected_result = {"source": "http://questions.assemblee-nationale.fr/q14/14-47351QE.htm", "legislature": "14", "type": "QE", "numero": "47351", "date_question": "2014-01-07", "date_retrait": "", "date_reponse": "2014-05-13", "date_signalement": "2014-04-15", "date_cht_attr": "2014-04-03", "page_question": "18", "page_reponse": "3858", "ministere_attribue": "Défense", "ministere_interroge": "Défense", "tete_analyse": "équipements", "analyse": "équipements militaires. vieillissement. bilan", "rubrique": "défense", "question": "M. François Cornut-Gentille interroge M. le ministre de la défense sur les équipements des unités du génie de l'armée de terre. Afin d'évaluer le coût du vieillissement des équipements militaires, il lui demande de préciser le nombre et le taux de disponibilité au 31 décembre 2012 et au 31 décembre 2013, le coût du MCO pour l'année 2013 et l'âge moyen de chacun des équipements des unités du génie de l'armée de terre.", "reponse": 'Les donn\xc3\xa9es relatives aux \xc3\xa9quipements du g\xc3\xa9nie d\xc3\xa9di\xc3\xa9s \xc3\xa0 l\'agencement de l\'espace terrestre sollicit\xc3\xa9es par l\'honorable parlementaire figurent dans le tableau suivant :<!-- DEBTAB --><div align=\\"center\\"><center><table border=\\"1\\"><tr> <th rowspan=\'2\\"\'>TYPE DE MAT\xc3\x89RIEL</th> <th colspan=\\"2\\">NOMBRE DE MAT\xc3\x89RIEL<br>en service</br></th> <th colspan=\\"2\\">TAUX DE DISPONIBILIT\xc3\x89<br>moyen (en %)</br></th> <th rowspan=\'2\\"\'>\xc3\x82GE MOYEN<br>des mat\xc3\xa9riels</br>(en ann\xc3\xa9es)</th> <th rowspan=\'2\\"\'>CO\xc3\x9bT UNITAIRE DU MAINTIEN<br>en condition op\xc3\xa9rationnelle en 2013</br>(en euros)</th> </tr><tr> <th>au<br>31-12-2012</br></th> <th>au<br>31-12-2013</br></th> <th>sur la dur\xc3\xa9e<br>de l\'ann\xc3\xa9e 2012</br></th> <th>sur la dur\xc3\xa9e<br>de l\'ann\xc3\xa9e 2013</br></th> </tr><tr> <td align=\\"center\\">AMX30B2 DT<br>(char t\xc3\xa9l\xc3\xa9command\xc3\xa9, \xc3\xa9quip\xc3\xa9 d\'outils de d\xc3\xa9minage pour permettre la cr\xc3\xa9ation de br\xc3\xa8ches)</br></td> <td align=\\"center\\">10</td> <td align=\\"center\\">10</td> <td align=\\"center\\">23,30</td> <td align=\\"center\\">37,60</td> <td align=\\"center\\">12</td> <td align=\\"center\\">194\xc2\xa0588</td> </tr><tr> <td align=\\"center\\">BUFFALO<br>(\xc3\xa9quipement de protection contre les engins explosifs)</br></td> <td align=\\"center\\">5</td> <td align=\\"center\\">5</td> <td align=\\"center\\">44,50</td> <td align=\\"center\\">25,40</td> <td align=\\"center\\">5</td> <td align=\\"center\\">30\xc2\xa0262</td> </tr><tr> <td align=\\"center\\">DISPERSEUR<br>(\xc3\xa9quipement permettant la r\xc3\xa9alisation rapide d\'un champ de mines antichars)</br></td> <td align=\\"center\\">18</td> <td align=\\"center\\">15</td> <td align=\\"center\\">46,30</td> <td align=\\"center\\">40,30</td> <td align=\\"center\\">16</td> <td align=\\"center\\">pas de march\xc3\xa9</td> </tr><tr> <td align=\\"center\\">EBG<br>(engin destin\xc3\xa9 \xc3\xa0 appuyer les unit\xc3\xa9s blind\xc3\xa9es en zone avant)</br></td> <td align=\\"center\\">42</td> <td align=\\"center\\">42</td> <td align=\\"center\\">22,00</td> <td align=\\"center\\">24,90</td> <td align=\\"center\\">20</td> <td align=\\"center\\">190\xc2\xa0013</td> </tr><tr> <td align=\\"center\\">EFA<br>(engin amphibie et ambidrome destin\xc3\xa9 \xc3\xa0 faire franchir tous les v\xc3\xa9hicules en dotation dans l\'arm\xc3\xa9e de terre)</br></td> <td align=\\"center\\">30</td> <td align=\\"center\\">30</td> <td align=\\"center\\">30,80</td> <td align=\\"center\\">37,40</td> <td align=\\"center\\">25</td> <td align=\\"center\\">200\xc2\xa0000</td> </tr><tr> <td align=\\"center\\">EGAME<br>(aide au d\xc3\xa9ploiement - franchissement de br\xc3\xa8ches, am\xc3\xa9lioration du terrain, terrassement, cr\xc3\xa9ation et am\xc3\xa9lioration de plateformes)</br></td> <td align=\\"center\\">35</td> <td align=\\"center\\">35</td> <td align=\\"center\\">63,50</td> <td align=\\"center\\">53,70</td> <td align=\\"center\\">5</td> <td align=\\"center\\">228\xc2\xa0400</td> </tr><tr> <td align=\\"center\\">EGRAP<br>(aide au d\xc3\xa9ploiement -am\xc3\xa9nagement et protection du terrain)</br></td> <td align=\\"center\\">138</td> <td align=\\"center\\">138</td> <td align=\\"center\\">67,90</td> <td align=\\"center\\">53,70</td> <td align=\\"center\\">4</td> <td align=\\"center\\">2\xc2\xa0756</td> </tr><tr> <td align=\\"center\\">EMAD<br>(aide au d\xc3\xa9ploiement - am\xc3\xa9nagement et protection du terrain)</br></td> <td align=\\"center\\">45</td> <td align=\\"center\\">45</td> <td align=\\"center\\">32,70</td> <td align=\\"center\\">28,10</td> <td align=\\"center\\">17</td> <td align=\\"center\\">12\xc2\xa0191</td> </tr><tr> <td align=\\"center\\">MADEZ<br>(mat\xc3\xa9riel de d\xc3\xa9minage de zone destin\xc3\xa9 \xc3\xa0 permettre le d\xc3\xa9ploiement et l\'installation d\'unit\xc3\xa9s)</br></td> <td align=\\"center\\">8</td> <td align=\\"center\\">8</td> <td align=\\"center\\">18,40</td> <td align=\\"center\\">19,50</td> <td align=\\"center\\">20</td> <td align=\\"center\\">3\xc2\xa0700</td> </tr><tr> <td align=\\"center\\">MATEM<br>(aide au d\xc3\xa9ploiement - mat\xc3\xa9riel de traitement de l\'eau)</br></td> <td align=\\"center\\">10</td> <td align=\\"center\\">7</td> <td align=\\"center\\">0,00</td> <td align=\\"center\\">9,00</td> <td align=\\"center\\">20</td> <td align=\\"center\\">19\xc2\xa0000</td> </tr><tr> <td align=\\"center\\">PFM<br>(aide au franchissement par la pose d\'un pont flottant) </br></td> <td align=\\"center\\">70</td> <td align=\\"center\\">70</td> <td align=\\"center\\">54,60</td> <td align=\\"center\\">50,00</td> <td align=\\"center\\">25</td> <td align=\\"center\\">6\xc2\xa0143</td> </tr><tr> <td align=\\"center\\">SDPMAC<br>(syst\xc3\xa8me permettant de neutraliser, par le tir de roquettes, les mines antichars enfouies ou dispers\xc3\xa9es au sol)</br></td> <td align=\\"center\\">12</td> <td align=\\"center\\">12</td> <td align=\\"center\\">11,90</td> <td align=\\"center\\">9,20</td> <td align=\\"center\\">6</td> <td align=\\"center\\">200\xc2\xa0000</td> </tr><tr> <td align=\\"center\\">SOUVIM 2<br>(v\xc3\xa9hicule de d\xc3\xa9tection multifonctions pour l\'ouverture d\'itin\xc3\xa9raires)</br></td> <td align=\\"center\\">8</td> <td align=\\"center\\">8</td> <td align=\\"center\\">71,10</td> <td align=\\"center\\">29,50</td> <td align=\\"center\\">4</td> <td align=\\"center\\">275\xc2\xa0000</td> </tr><tr> <td align=\\"center\\">SPRAT<br>(aide au franchissement des coupures par la pose rapide de travures pour les v\xc3\xa9hicules chenill\xc3\xa9s ou \xc3\xa0 roues)</br></td> <td align=\\"center\\">8</td> <td align=\\"center\\">10</td> <td align=\\"center\\">100,00</td> <td align=\\"center\\">96,50</td> <td align=\\"center\\">2</td> <td align=\\"center\\">309\xc2\xa0500</td> </tr><tr> <td align=\\"center\\">VAB G\xc3\xa9nie</td> <td align=\\"center\\">314</td> <td align=\\"center\\">302</td> <td align=\\"center\\">43,10</td> <td align=\\"center\\">36,70</td> <td align=\\"center\\">30</td> <td align=\\"center\\">28\xc2\xa0972</td> </tr><tr> <td align=\\"center\\">VBHP<br>(v\xc3\xa9hicule blind\xc3\xa9 d\'accompagnement des d\xc3\xa9tachements - ouverture d\'itin\xc3\xa9raires pi\xc3\xa9g\xc3\xa9s)</br></td> <td align=\\"center\\">15</td> <td align=\\"center\\">14</td> <td align=\\"center\\">70,30</td> <td align=\\"center\\">11,30</td> <td align=\\"center\\">4</td> <td align=\\"center\\">125\xc2\xa0000</td> </tr></table></center></div><!-- FINTAB -->', "motif_retrait": "", "auteur": "François Cornut-Gentille"}

        data = requests.get(expected_result['source']).content
        parsing_result = parse_question(expected_result['source'], data)

        self.assertDictEqual(expected_result, parsing_result)


if __name__ == '__main__':
    unittest.main()